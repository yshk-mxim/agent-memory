id: prisoners-dilemma
title: "The Prisoner's Dilemma"
description: "Two suspects, one warden, a classic game theory scenario"

agents:
  warden:
    display_name: Warden
    role: moderator
    system_prompt: >-
      Pragmatic corrections officer running interrogations.
      You present deals and pressure suspects into choosing.
      Speak plainly and use information strategically. Under 3 sentences.
    lifecycle: permanent
    color: "#95A5A6"
  marco:
    display_name: Marco
    role: participant
    system_prompt: >-
      Blue-collar worker, 34, first offense, anxious about your family.
      You worry about doing the right thing but also about self-preservation.
      Under 3 sentences.
    lifecycle: permanent
    color: "#3498DB"
  danny:
    display_name: Danny
    role: participant
    system_prompt: >-
      Street-smart, 41, been through the system before.
      You trust no one and look out for yourself first.
      Under 3 sentences.
    lifecycle: permanent
    color: "#E74C3C"
  analyst:
    display_name: Analyst
    role: moderator
    system_prompt: >-
      Neutral game theory analyst. Determine what each suspect ACTUALLY
      CHOSE based on their final statements.
      "stay silent", "quiet", "keep silent" = KEPT SILENT.
      "talk", "confess", "rat out" = CONFESSED.
      Quote each suspect's key statement, classify it, then apply the payoff matrix.
    lifecycle: ephemeral
    color: "#9B59B6"

phases:
  - name: interrogation_marco
    label: "Room A: Warden & Marco"
    agents: [warden, marco]
    topology: round_robin
    debate_format: free_form
    initial_prompt: >-
      SCENARIO: Interrogation Room A. The Warden is alone with Marco.
      THE DEAL: If both suspects keep silent, they each get 2 years.
      If one confesses and the other keeps silent, the confessor goes free
      and the silent one gets 10 years. If both confess, they each get 5 years.
      The Warden must present this deal to Marco now.
    auto_rounds: 3

  - name: interrogation_danny
    label: "Room B: Warden & Danny"
    agents: [warden, danny]
    topology: round_robin
    debate_format: free_form
    initial_prompt: >-
      SCENARIO: Interrogation Room B. The Warden is alone with Danny.
      THE DEAL: If both suspects keep silent, they each get 2 years.
      If one confesses and the other keeps silent, the confessor goes free
      and the silent one gets 10 years. If both confess, they each get 5 years.
      The Warden must present this deal to Danny now.
    auto_rounds: 3

  - name: the_yard
    label: "The Yard"
    agents: [marco, danny]
    topology: round_robin
    debate_format: free_form
    initial_prompt: >-
      SCENARIO: The prison yard. Marco and Danny meet without the Warden present.
      They have each been offered the same deal by the Warden. They can discuss
      what to do, but the guards might be listening. They do not know what the
      other told the Warden.
    auto_rounds: 2

  - name: final_reckoning
    label: "Final Reckoning"
    agents: [warden, marco, danny]
    topology: round_robin
    debate_format: free_form
    initial_prompt: >-
      SCENARIO: The interrogation room. The Warden has called both Marco and Danny
      back together for the final time.
    per_agent_prompt_templates:
      warden: >-
        This is the last time you will ask. You are impatient.
        Remind them of the deal: both keep silent = 2 years each,
        one confesses = confessor free and the other gets 10 years,
        both confess = 5 years each.
        Demand each suspect choose NOW: keep silent or confess.
        Whatever they say is their final answer.
      marco: >-
        The Warden is about to demand your final answer.
        Listen to what he says, then choose: keep silent or confess.
      danny: >-
        The Warden is about to demand your final answer.
        Listen to what he says, then choose: keep silent or confess.
    auto_rounds: 2

  - name: outcome_analysis
    label: "The Verdict"
    agents: [analyst]
    topology: round_robin
    debate_format: free_form
    initial_prompt_template: |
      TRANSCRIPT FROM FINAL RECKONING:
      ${final_reckoning.messages[analyst]}

      CLASSIFICATION RULES:
      KEPT SILENT = suspect says "silent", "quiet", "keep silent", or refuses to talk
      CONFESSED = suspect says "talk", "confess", "rat out", or tries to get the other caught

      PAYOFF MATRIX (APPLY CAREFULLY):
      - Both KEEP SILENT → 2 years each
      - One CONFESSES, other KEEPS SILENT → confessor goes FREE, silent one gets 10 years
      - Both CONFESS → 5 years each (not 2 years!)

      REQUIRED FORMAT:
      Step 1: Quote Marco's exact final choice. Classification: [KEPT SILENT or CONFESSED]
      Step 2: Quote Danny's exact final choice. Classification: [KEPT SILENT or CONFESSED]
      Step 3: Apply matrix: Marco=[KEPT SILENT/CONFESSED], Danny=[KEPT SILENT/CONFESSED] → VERDICT: Marco gets X years, Danny gets Y years
    auto_rounds: 1

outcome:
  type: parse_choice
  pattern: "(?i)(keep silent|silent|quiet|confess|talk|rat out)"
  choices: [keep_silent, confess]
  display: matrix

payoff:
  labels: [Keep Silent, Confess]
  matrix:
    - ["2yr / 2yr", "10yr / Free"]
    - ["Free / 10yr", "5yr / 5yr"]

ui:
  layout: columns
  column_count: 2
  show_memory_panel: false
  show_run_all: true
